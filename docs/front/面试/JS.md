# js

## å˜é‡ã€ä½œç”¨åŸŸå’Œå†…å­˜

### å¯¹è±¡å¾ªç¯å¼•ç”¨ä¼šå‘ç”Ÿä»€ä¹ˆ

[ç®€å•èŠä¸€èŠJSä¸­çš„å¾ªç¯å¼•ç”¨åŠé—®é¢˜](https://www.cnblogs.com/zhangguicheng/p/12173538.html)

1. ï¼ˆç®€ç•¥çš„è¯´ä¸‹ï¼‰ä½¿ç”¨**å¼•ç”¨è®¡æ•°æ³•**æ—¶ï¼Œä¸¤ä¸ªå¯¹è±¡äº’ç›¸å¼•ç”¨ï¼Œå°±ç®—è¿è¡Œå®Œå°†ä¸¤ä¸ªå˜é‡éƒ½æ¸…ç©ºï¼Œå¼•ç”¨è®¡æ•°å™¨ä¹Ÿä¸ä¼šæ¸…ç©ºï¼Œå°±ä¼šä¼šé€ æˆå†…å­˜æ³„æ¼ï¼›ä½†æ˜¯ç°åœ¨çš„**æ ‡è®°æ¸…é™¤æ³•**ä¸ä¼šæœ‰è¿™æ ·çš„é—®é¢˜
   - **æ ‡è®°æ¸…é™¤**å›æ”¶ç­–ç•¥çš„å¤§è‡´æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œæœ€å¼€å§‹çš„æ—¶å€™**å°†æ‰€æœ‰çš„å˜é‡åŠ ä¸Šæ ‡è®°**ï¼Œ**cycularReference å‡½æ•°çš„æ—¶å€™ä¼šå°†å‡½æ•°å†…éƒ¨çš„å˜é‡è¿™äº›æ ‡è®°æ¸…é™¤*ï¼Œ å‡½æ•°æ‰§è¡Œå®Œåå†åŠ ä¸Šæ ‡è®°**
2. `JSON.stringfy()`è½¬æ¢ä¼šæŠ¥é”™ï¼Œå› ä¸ºå…¶æ— æ³•å°†ä¸€ä¸ªæ— é™å¾ªç¯è½¬æ¢çš„å¯¹è±¡è½¬ä¸ºæ™®é€šçš„string



### JavaScriptåƒåœ¾å›æ”¶æœºåˆ¶

[ã€Œç¡¬æ ¸JSã€ä½ çœŸçš„äº†è§£åƒåœ¾å›æ”¶æœºåˆ¶å—](https://juejin.cn/post/6981588276356317214)

[JavaScriptåƒåœ¾å›æ”¶æœºåˆ¶](https://zhuanlan.zhihu.com/p/60336501)

1. æ ‡è®°æ¸…é™¤ï¼ˆmark and sweepï¼‰
2. å¼•ç”¨è®¡æ•°ï¼ˆreference countingï¼‰



>  è¿™ä¸ªè¿‡ç¨‹æ˜¯å‘¨æœŸæ€§çš„ï¼Œå³åƒåœ¾å›æ”¶ç¨‹åºæ¯éš”ä¸€å®šæ—¶é—´ï¼ˆæˆ–è€…è¯´åœ¨ä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­æŸä¸ªé¢„å®šçš„æ”¶é›†æ—¶é—´ï¼‰å°±ä¼šè‡ªåŠ¨è¿è¡Œã€‚åƒåœ¾å›æ”¶è¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿‘ä¼¼ä¸”ä¸å®Œç¾çš„æ–¹æ¡ˆï¼Œå› ä¸ºæŸå—å†…å­˜æ˜¯å¦è¿˜æœ‰ç”¨ï¼Œå±äºâ€œä¸å¯åˆ¤å®šçš„â€é—®é¢˜ï¼Œæ„å‘³ç€é ç®—æ³•æ˜¯è§£å†³ä¸äº†çš„
>
>  æˆ‘ä»¬ä»¥å‡½æ•°ä¸­å±€éƒ¨å˜é‡çš„æ­£å¸¸ç”Ÿå‘½å‘¨æœŸä¸ºä¾‹ã€‚å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ä¼šåœ¨å‡½æ•°æ‰§è¡Œæ—¶å­˜åœ¨ã€‚æ­¤æ—¶ï¼Œæ ˆï¼ˆæˆ–å †ï¼‰å†…å­˜ä¼šåˆ†é…ç©ºé—´ä»¥ä¿å­˜ç›¸åº”çš„å€¼ã€‚å‡½æ•°åœ¨å†…éƒ¨ä½¿ç”¨äº†å˜é‡ï¼Œç„¶åé€€å‡ºã€‚æ­¤æ—¶ï¼Œå°±ä¸å†éœ€è¦é‚£ä¸ªå±€éƒ¨å˜é‡äº†ï¼Œå®ƒå ç”¨çš„å†…å­˜å¯ä»¥é‡Šæ”¾ï¼Œä¾›åé¢ä½¿ç”¨ã€‚è¿™ç§æƒ…å†µä¸‹æ˜¾ç„¶ä¸å†éœ€è¦å±€éƒ¨å˜é‡äº†ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰æ—¶å€™éƒ½ä¼šè¿™ä¹ˆæ˜æ˜¾ã€‚åƒåœ¾å›æ”¶ç¨‹åºå¿…é¡»è·Ÿè¸ªè®°å½•å“ªä¸ªå˜é‡è¿˜ä¼šä½¿ç”¨ï¼Œä»¥åŠå“ªä¸ªå˜é‡ä¸ä¼šå†ä½¿ç”¨ï¼Œä»¥ä¾¿å›æ”¶å†…å­˜ã€‚å¦‚ä½•æ ‡è®°æœªä½¿ç”¨çš„å˜é‡ä¹Ÿè®¸æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œç”¨åˆ°è¿‡ä¸¤ç§ä¸»è¦çš„æ ‡è®°ç­–ç•¥ï¼šæ ‡è®°æ¸…ç†å’Œå¼•ç”¨è®¡æ•°

**è§£é™¤å¯¹ä¸€ä¸ªå€¼çš„å¼•ç”¨å¹¶ä¸ä¼šè‡ªåŠ¨å¯¼è‡´ç›¸å…³å†…å­˜è¢«å›æ”¶ã€‚è§£é™¤å¼•ç”¨çš„å…³é”®åœ¨äºç¡®ä¿ç›¸å…³çš„å€¼å·²ç»ä¸åœ¨ä¸Šä¸‹æ–‡é‡Œäº†ï¼Œå› æ­¤å®ƒåœ¨ä¸‹æ¬¡åƒåœ¾å›æ”¶æ—¶ä¼šè¢«å›æ”¶ã€‚**

### ä»€ä¹ˆæƒ…å†µä¼šå¼•èµ·å†…å­˜æ³„æ¼

[JSä¸­4ç§å¸¸è§çš„å†…å­˜æ³„æ¼](https://blog.csdn.net/weixin_44786530/article/details/126617193)

[å†…å­˜ç®¡ç†](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management)

1. **æ„å¤–çš„å…¨å±€å˜é‡å¼•èµ·çš„å†…å­˜æ³„æ¼ã€‚**

```js
function foo(arg) {
    bar = "this is a hidden global variable";// å®é™…ä¸Šæ˜¯ï¼š window.bar = "this is an explicit global variable";
}

function bar() {
    this.variable = "potential accidental global";
} 
bar();// fooå‡½æ•°å†å…¨å±€ä½œç”¨åŸŸä¸­è¢«è°ƒç”¨ï¼Œå› æ­¤thisæŒ‡å‘window
```

è§£å†³æ–¹æ³•ï¼Œä½¿ç”¨ä¸¥æ ¼æ¨¡å¼é¿å…`"use strict"`

2. **é—­åŒ…å¼•èµ·çš„å†…å­˜æ³„æ¼**

é—­åŒ…å¯ä»¥ä½¿å˜é‡å¸¸é©»å†…å­˜ï¼Œä½†å¦‚æœä½¿ç”¨ä¸å½“å°±ä¼šåœ¨æˆå†…å­˜æ³„æ¼

```js
var theThing = null;
var replaceThing = function () {
  var originalThing = theThing;
  var unused = function () {
    if (originalThing)
      console.log("hi");
  };
  theThing = {
    longStr: new Array(1000000).join('*'),
    someMethod: function () {
      console.log("someMessage");
    }
  };
};
setInterval(replaceThing, 1000);
```

> æ¯æ¬¡è°ƒç”¨ `replaceThing` æ—¶ï¼Œ`theThing` éƒ½ä¼šå¾—åˆ°æ–°çš„åŒ…å«ä¸€ä¸ªå¤§æ•°ç»„å’Œæ–°çš„é—­åŒ…ï¼ˆ`someMethod`ï¼‰çš„å¯¹è±¡ã€‚
>
> åŒæ—¶ï¼Œæ²¡æœ‰ç”¨åˆ°çš„é‚£ä¸ªå˜é‡æŒæœ‰ä¸€ä¸ªå¼•ç”¨äº† `originalThing`ï¼ˆ`replaceThing` è°ƒç”¨ä¹‹å‰çš„ `theThing`ï¼‰é—­åŒ…ã€‚
>
> å…³é”®çš„é—®é¢˜æ˜¯æ¯å½“åœ¨åŒä¸€ä¸ªçˆ¶ä½œç”¨åŸŸä¸‹åˆ›å»ºé—­åŒ…ä½œç”¨åŸŸçš„æ—¶å€™ï¼Œè¿™ä¸ªä½œç”¨åŸŸæ˜¯è¢«å…±äº«çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ`someMethod` çš„é—­åŒ…ä½œç”¨åŸŸå’Œ `unused` çš„ä½œç”¨åŸŸæ˜¯å…±äº«çš„ã€‚
>
> `unused` æŒæœ‰ä¸€ä¸ª `originalThing` çš„å¼•ç”¨ã€‚å°½ç®¡ `unused` ä»æ¥æ²¡æœ‰è¢«ä½¿ç”¨è¿‡ï¼Œ`someMethod` å¯ä»¥åœ¨ `theThing` ä¹‹å¤–è¢«è®¿é—®ã€‚
>
> è€Œä¸” `someMethod` å’Œ `unused` å…±äº«äº†é—­åŒ…ä½œç”¨åŸŸï¼Œå³ä¾¿ `unused` ä»æ¥éƒ½æ²¡æœ‰è¢«ä½¿ç”¨è¿‡ï¼Œå®ƒå¯¹ `originalThing` çš„å¼•ç”¨è¿˜æ˜¯å¼ºåˆ¶å®ƒä¿æŒæ´»è·ƒçŠ¶æ€ï¼ˆé˜»æ­¢å®ƒè¢«å›æ”¶ï¼‰ã€‚
>
> å½“è¿™æ®µä»£ç é‡å¤è¿è¡Œæ—¶ï¼Œå°†å¯ä»¥è§‚å¯Ÿåˆ°å†…å­˜æ¶ˆè€—ç¨³å®šåœ°ä¸Šæ¶¨ï¼Œå¹¶ä¸”ä¸ä¼šå› ä¸º GC çš„å­˜åœ¨è€Œä¸‹é™ã€‚
>
> æœ¬è´¨ä¸Šæ¥è®²ï¼Œåˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…é“¾è¡¨ï¼ˆæ ¹èŠ‚ç‚¹æ˜¯ `theThing` å½¢å¼çš„å˜é‡ï¼‰ï¼Œè€Œä¸”æ¯ä¸ªé—­åŒ…ä½œç”¨åŸŸéƒ½æŒæœ‰ä¸€ä¸ªå¯¹å¤§æ•°ç»„çš„é—´æ¥å¼•ç”¨ï¼Œè¿™å¯¼è‡´äº†ä¸€ä¸ªå·¨å¤§çš„å†…å­˜æ³„éœ²ã€‚

3. **æ²¡æœ‰æ¸…ç†çš„DOMå…ƒç´ å¼•ç”¨**

åŸå› ï¼šè™½ç„¶åˆ«çš„åœ°æ–¹åˆ é™¤äº†ï¼Œä½†æ˜¯å¯¹è±¡ä¸­è¿˜å­˜åœ¨å¯¹domçš„å¼•ç”¨

è§£å†³ï¼šæ‰‹åŠ¨åˆ é™¤ã€‚

4. **è¢«é—å¿˜çš„å®šæ—¶å™¨æˆ–è€…å›è°ƒ**

æ‰‹åŠ¨åˆ é™¤å®šæ—¶å™¨

5. **å­å…ƒç´ å­˜åœ¨å¼•ç”¨å¼•èµ·çš„å†…å­˜æ³„æ¼**

åŸå› ï¼šdivä¸­çš„ul li å¾—åˆ°è¿™ä¸ªdivï¼Œä¼šé—´æ¥å¼•ç”¨æŸä¸ªå¾—åˆ°çš„liï¼Œé‚£ä¹ˆæ­¤æ—¶å› ä¸ºdivé—´æ¥å¼•ç”¨liï¼Œå³ä½¿liè¢«æ¸…ç©ºï¼Œä¹Ÿè¿˜æ˜¯åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”åªè¦liä¸è¢«åˆ é™¤ï¼Œä»–çš„çˆ¶å…ƒç´ éƒ½ä¸ä¼šè¢«åˆ é™¤ã€‚

## é™æ€åˆ†é…ä¸å¯¹è±¡æ± 

> ä¸ºäº†æå‡ JavaScript æ€§èƒ½ï¼Œæœ€åè¦è€ƒè™‘çš„ä¸€ç‚¹å¾€å¾€å°±æ˜¯å‹æ¦¨æµè§ˆå™¨äº†ã€‚æ­¤æ—¶ï¼Œä¸€ä¸ªå…³é”®é—®é¢˜å°±æ˜¯**å¦‚ä½•å‡å°‘æµè§ˆå™¨æ‰§è¡Œåƒåœ¾å›æ”¶çš„æ¬¡æ•°**ã€‚å¼€å‘è€…æ— æ³•ç›´æ¥æ§åˆ¶ä»€ä¹ˆæ—¶å€™å¼€å§‹æ”¶é›†åƒåœ¾ï¼Œä½†**å¯ä»¥é—´æ¥æ§åˆ¶è§¦å‘åƒåœ¾å›æ”¶çš„æ¡ä»¶**ã€‚ç†è®ºä¸Šï¼Œå¦‚æœèƒ½å¤Ÿåˆç†ä½¿ç”¨åˆ†é…çš„å†…å­˜ï¼ŒåŒæ—¶é¿å…å¤šä½™çš„åƒåœ¾å›æ”¶ï¼Œé‚£å°±å¯ä»¥ä¿ä½å› é‡Šæ”¾å†…å­˜è€ŒæŸå¤±çš„æ€§èƒ½ã€‚**æµè§ˆå™¨å†³å®šä½•æ—¶è¿è¡Œåƒåœ¾å›æ”¶ç¨‹åºçš„ä¸€ä¸ªæ ‡å‡†å°±æ˜¯å¯¹è±¡æ›´æ›¿çš„é€Ÿåº¦**

```js
function addVector(a, b) { 
 let resultant = new Vector(); 
 resultant.x = a.x + b.x; 
 resultant.y = a.y + b.y; 
 return resultant; 
}
```

ä¸Šé¢è¿™ä¸ªå‡½æ•°ï¼Œå¦‚æœé¢‘ç¹åˆ›å»ºçš„è¯ï¼Œå°±ä¼šä¸€ç›´åˆ›å»ºä¸€ä¸ªæ–°çš„Vectorï¼Œæ›´å¿«çš„è§¦å‘åƒåœ¾å›æ”¶ã€‚æ‰€ä»¥ï¼Œä¸è®©å®ƒä¸€ç›´åˆ›å»ºï¼Œå°±å¯ä»¥æå‡æ€§èƒ½

```js
function addVector(a, b, resultant) { 
 resultant.x = a.x + b.x; 
 resultant.y = a.y + b.y; 
 return resultant; 
}
```

å½“ç„¶ï¼Œè¿™éœ€è¦åœ¨å…¶ä»–åœ°æ–¹å®ä¾‹åŒ–çŸ¢é‡å‚æ•° resultantï¼Œä½†è¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºæ²¡æœ‰å˜ã€‚é‚£ä¹ˆåœ¨å“ªé‡Œåˆ›å»ºçŸ¢é‡å¯ä»¥ä¸è®©åƒåœ¾å›æ”¶è°ƒåº¦ç¨‹åºç›¯ä¸Šå‘¢ï¼Ÿ

**ä¸€ä¸ªç­–ç•¥æ˜¯ä½¿ç”¨å¯¹è±¡æ± **ã€‚åœ¨åˆå§‹åŒ–çš„æŸä¸€æ—¶åˆ»ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ± ï¼Œç”¨æ¥ç®¡ç†ä¸€ç»„å¯å›æ”¶çš„å¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥å‘è¿™ä¸ªå¯¹è±¡æ± è¯·æ±‚ä¸€ä¸ªå¯¹è±¡ã€è®¾ç½®å…¶å±æ€§ã€ä½¿ç”¨å®ƒï¼Œç„¶ååœ¨æ“ä½œå®Œæˆåå†æŠŠå®ƒè¿˜ç»™å¯¹è±¡æ± ã€‚ç”±äºæ²¡å‘ç”Ÿå¯¹è±¡åˆå§‹åŒ–ï¼Œåƒåœ¾å›æ”¶æ¢æµ‹å°±ä¸ä¼šå‘ç°æœ‰å¯¹è±¡æ›´æ›¿ï¼Œå› æ­¤åƒåœ¾å›æ”¶ç¨‹åºå°±ä¸ä¼šé‚£ä¹ˆé¢‘ç¹åœ°è¿è¡Œ

```js
// vectorPool æ˜¯å·²æœ‰çš„å¯¹è±¡æ±  
let v1 = vectorPool.allocate(); 
let v2 = vectorPool.allocate(); 
let v3 = vectorPool.allocate(); 
v1.x = 10; 
v1.y = 5; 
v2.x = -3; 
v2.y = -6; 
addVector(v1, v2, v3); 
console.log([v3.x, v3.y]); // [7, -1] 
// é‡Šæ”¾
vectorPool.free(v1); 
vectorPool.free(v2); 
vectorPool.free(v3); 
// å¦‚æœå¯¹è±¡æœ‰å±æ€§å¼•ç”¨äº†å…¶ä»–å¯¹è±¡
// åˆ™è¿™é‡Œä¹Ÿéœ€è¦æŠŠè¿™äº›å±æ€§è®¾ç½®ä¸º null 
v1 = null; 
v2 = null; 
v3 = null;
```

å¦‚æœå¯¹è±¡æ± åªæŒ‰éœ€åˆ†é…çŸ¢é‡**ï¼ˆåœ¨å¯¹è±¡ä¸å­˜åœ¨æ—¶åˆ›å»ºæ–°çš„ï¼Œåœ¨å¯¹è±¡å­˜åœ¨æ—¶åˆ™å¤ç”¨å­˜åœ¨çš„ï¼‰**ï¼Œé‚£ä¹ˆè¿™ä¸ªå®ç°æœ¬è´¨ä¸Šæ˜¯ä¸€ç§**è´ªå©ªç®—æ³•**ï¼Œæœ‰å•è°ƒå¢é•¿ä½†ä¸ºé™æ€çš„å†…å­˜ã€‚è¿™ä¸ªå¯¹è±¡æ± å¿…é¡»ä½¿ç”¨æŸç§ç»“æ„ç»´æŠ¤æ‰€æœ‰å¯¹è±¡ï¼Œæ•°ç»„æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚ä¸è¿‡ï¼Œä½¿ç”¨æ•°ç»„æ¥å®ç°ï¼Œå¿…é¡»ç•™æ„ä¸è¦æ‹›è‡´é¢å¤–çš„åƒåœ¾å›æ”¶

```js
let vectorList = new Array(100); 
let vector = new Vector(); 
vectorList.push(vector);
```

ç”±äº JavaScript æ•°ç»„çš„å¤§å°æ˜¯åŠ¨æ€å¯å˜çš„ï¼Œå¼•æ“ä¼šåˆ é™¤å¤§å°ä¸º 100 çš„æ•°ç»„ï¼Œå†åˆ›å»ºä¸€ä¸ªæ–°çš„å¤§å°ä¸º200 çš„æ•°ç»„ã€‚åƒåœ¾å›æ”¶ç¨‹åºä¼šçœ‹åˆ°è¿™ä¸ªåˆ é™¤æ“ä½œï¼Œè¯´ä¸å®šå› æ­¤å¾ˆå¿«å°±ä¼šè·‘æ¥æ”¶ä¸€æ¬¡åƒåœ¾ã€‚è¦é¿å…è¿™ç§åŠ¨æ€åˆ†é…æ“ä½œï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–æ—¶å°±åˆ›å»ºä¸€ä¸ªå¤§å°å¤Ÿç”¨çš„æ•°ç»„ï¼Œä»è€Œé¿å…ä¸Šè¿°å…ˆåˆ é™¤å†åˆ›å»ºçš„æ“ä½œã€‚ä¸è¿‡ï¼Œ**å¿…é¡»äº‹å…ˆæƒ³å¥½è¿™ä¸ªæ•°ç»„æœ‰å¤šå¤§**

> é™æ€åˆ†é…æ˜¯ä¼˜åŒ–çš„ä¸€ç§æç«¯å½¢å¼ã€‚å¦‚æœä½ çš„åº”ç”¨ç¨‹åºè¢«åƒåœ¾å›æ”¶ä¸¥é‡åœ°æ‹–äº†åè…¿ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæå‡æ€§èƒ½ã€‚ä½†è¿™ç§æƒ…å†µå¹¶ä¸å¤šè§ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™éƒ½å±äºè¿‡æ—©ä¼˜åŒ–ï¼Œå› æ­¤ä¸ç”¨è€ƒè™‘ã€‚



## å †æ ˆ

[JavaScript å†…å­˜æœºåˆ¶](https://blog.csdn.net/davidffffff/article/details/107716345)

**åŸºæœ¬ç±»å‹**çš„å€¼ï¼ˆUndefined/Null/Boolean/Number/Stringï¼‰è¢«ä¿å­˜åœ¨**æ ˆå†…å­˜**ä¸­ã€‚ä»ä¸€ä¸ªå˜é‡å‘å¦ä¸€ä¸ªå˜é‡**å¤åˆ¶åŸºæœ¬ç±»å‹çš„å€¼**ï¼Œ**ä¼šåˆ›å»ºè¿™ä¸ªå€¼çš„ä¸€ä¸ªå‰¯æœ¬**ã€‚

- **å¼•ç”¨ç±»å‹**çš„å€¼æ˜¯å¯¹è±¡ï¼Œä¿å­˜åœ¨**å †å†…å­˜**ä¸­ã€‚
  - åŒ…å«å¼•ç”¨ç±»å‹å€¼çš„å˜é‡å®é™…ä¸ŠåŒ…å«çš„å¹¶ä¸æ˜¯å¯¹è±¡æœ¬èº«ï¼Œè€Œæ˜¯ä¸€ä¸ª**æŒ‡å‘è¯¥å¯¹è±¡çš„æŒ‡é’ˆ**ã€‚ä»ä¸€ä¸ªå˜é‡å‘å¦ä¸€ä¸ªå˜é‡å¤åˆ¶å¼•ç”¨ç±»å‹çš„å€¼ï¼Œ**å¤åˆ¶çš„å…¶å®æ˜¯æŒ‡é’ˆï¼Œå› æ­¤ä¸¤ä¸ªå˜é‡æœ€ç»ˆéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡**ã€‚
  - jsä¸å…è®¸ç›´æ¥è®¿é—®å†…å­˜ä¸­çš„ä½ç½®ï¼Œä¹Ÿå°±æ˜¯**ä¸èƒ½ç›´æ¥è®¿é—®æ“ä½œå¯¹è±¡çš„å†…å­˜ç©ºé—´**ã€‚åœ¨æ“ä½œå¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨æ“ä½œå¯¹è±¡çš„å¼•ç”¨è€Œä¸æ˜¯å®é™…çš„å¯¹è±¡ã€‚



1ã€**å †æ ˆç©ºé—´**åˆ†é…åŒºåˆ«ï¼š

- æ ˆï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼šç”±**æ“ä½œç³»ç»Ÿè‡ªåŠ¨åˆ†é…é‡Šæ”¾** ï¼Œ**å­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œå±€éƒ¨å˜é‡çš„å€¼ç­‰**ã€‚å…¶æ“ä½œæ–¹å¼ç±»ä¼¼äº**æ•°æ®ç»“æ„ä¸­çš„æ ˆ**

- å †ï¼ˆæ“ä½œç³»ç»Ÿï¼‰ï¼š ä¸€èˆ¬ç”±**ç¨‹åºå‘˜åˆ†é…é‡Šæ”¾ï¼Œè‹¥ç¨‹åºå‘˜ä¸é‡Šæ”¾ï¼Œç¨‹åºç»“æŸæ—¶å¯èƒ½ç”±OSå›æ”¶ï¼Œåˆ†é…æ–¹å¼å€’æ˜¯ç±»ä¼¼äºé“¾è¡¨**

2ã€å †æ ˆç¼“å­˜æ–¹å¼åŒºåˆ«ï¼š

- æ ˆä½¿ç”¨çš„æ˜¯**ä¸€çº§ç¼“å­˜**ï¼Œ ä»–ä»¬é€šå¸¸éƒ½æ˜¯è¢«è°ƒç”¨æ—¶å¤„äº**å­˜å‚¨ç©ºé—´ï¼ˆå†…å­˜ï¼‰**ä¸­ï¼Œ**è°ƒç”¨å®Œæ¯•ç«‹å³é‡Šæ”¾**

- å †æ˜¯å­˜æ”¾åœ¨**äºŒçº§ç¼“å­˜**ä¸­ï¼Œ**ç”Ÿå‘½å‘¨æœŸç”±è™šæ‹Ÿæœºçš„åƒåœ¾å›æ”¶ç®—æ³•æ¥å†³å®š**ï¼ˆå¹¶ä¸æ˜¯ä¸€æ—¦æˆä¸ºå­¤å„¿å¯¹è±¡å°±èƒ½è¢«å›æ”¶ï¼‰ã€‚æ‰€ä»¥è°ƒç”¨è¿™äº›å¯¹è±¡çš„é€Ÿåº¦è¦ç›¸å¯¹æ¥å¾—ä½ä¸€äº›ã€‚

3ã€å †æ ˆæ•°æ®ç»“æ„åŒºåˆ«ï¼š

- å †ï¼ˆæ•°æ®ç»“æ„ï¼‰ï¼šå †å¯ä»¥è¢«çœ‹æˆæ˜¯ä¸€æ£µæ ‘ï¼Œå¦‚ï¼šå †æ’åºï¼›
- æ ˆï¼ˆæ•°æ®ç»“æ„ï¼‰ï¼šä¸€ç§å…ˆè¿›åå‡ºçš„æ•°æ®ç»“æ„ã€‚

> https://blog.csdn.net/viewyu12345/article/details/108703891)

## å¯¹è±¡

ECMA-262 å°†å¯¹è±¡å®šä¹‰ä¸ºä¸€ç»„**å±æ€§çš„æ— åºé›†åˆ**, å¯ä»¥æŠŠ ECMAScript çš„å¯¹è±¡æƒ³è±¡æˆä¸€å¼ **æ•£åˆ—è¡¨**ï¼Œå…¶ä¸­çš„å†…å®¹å°±æ˜¯**ä¸€ç»„å/å€¼å¯¹**ï¼Œå€¼å¯ä»¥æ˜¯

æ•°æ®æˆ–è€…å‡½æ•°ã€‚

### å¯¹è±¡çš„å±æ€§

ECMA-262 ä½¿ç”¨ä¸€äº›**å†…éƒ¨ç‰¹æ€§**æ¥æè¿°å±æ€§çš„ç‰¹å¾ã€‚è¿™äº›ç‰¹æ€§æ˜¯ç”±ä¸º JavaScript å®ç°å¼•æ“çš„è§„èŒƒå®šä¹‰çš„ã€‚å› æ­¤ï¼Œå¼€å‘è€…ä¸èƒ½åœ¨ JavaScript ä¸­ç›´æ¥è®¿é—®è¿™äº›ç‰¹æ€§ã€‚ä¸ºäº†å°†æŸä¸ªç‰¹æ€§æ ‡è¯†ä¸ºå†…éƒ¨ç‰¹æ€§ï¼Œè§„èŒƒä¼šç”¨ä¸¤ä¸ªä¸­æ‹¬å·æŠŠç‰¹æ€§çš„åç§°æ‹¬èµ·æ¥ï¼Œæ¯”å¦‚`[[Enumerable]]`ã€‚

æœ‰äº›åœ°æ–¹åˆå«åš**æè¿°ç¬¦(Descriptor)**

- `[[Configurable]]`ï¼šè¡¨ç¤ºå±æ€§**æ˜¯å¦å¯ä»¥é€šè¿‡ delete åˆ é™¤å¹¶é‡æ–°å®šä¹‰**ï¼Œ**æ˜¯å¦å¯ä»¥ä¿®æ”¹å®ƒçš„ç‰¹æ€§(Object.defineProperty)**ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥æŠŠå®ƒ**æ”¹ä¸ºè®¿é—®å™¨å±æ€§(get / set)**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç›´æ¥å®šä¹‰åœ¨å¯¹è±¡ä¸Šçš„å±æ€§çš„è¿™ä¸ªç‰¹æ€§éƒ½æ˜¯ trueï¼Œå¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºã€‚

- `[[Enumerable]]`ï¼šè¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡ **for-in å¾ªç¯è¿”å›**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç›´æ¥å®šä¹‰åœ¨å¯¹è±¡ä¸Šçš„å±æ€§çš„è¿™ä¸ªç‰¹æ€§éƒ½æ˜¯ trueï¼Œå¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºã€‚

- `[[Writable]]`ï¼šè¡¨ç¤ºå±æ€§çš„**å€¼æ˜¯å¦å¯ä»¥è¢«ä¿®æ”¹**ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç›´æ¥å®šä¹‰åœ¨å¯¹è±¡ä¸Šçš„å±æ€§çš„è¿™ä¸ªç‰¹æ€§éƒ½æ˜¯ trueï¼Œå¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºã€‚

- `[[Value]]`ï¼šåŒ…å«**å±æ€§å®é™…çš„å€¼**ã€‚è¿™å°±æ˜¯å‰é¢æåˆ°çš„é‚£ä¸ª**è¯»å–å’Œå†™å…¥å±æ€§å€¼(è®¿é—®å™¨è®¾ç½®/è¯»å–çš„å€¼)**çš„ä½ç½®ã€‚è¿™ä¸ªç‰¹æ€§çš„é»˜è®¤å€¼ä¸º undefinedã€‚

å±æ€§æ“ä½œ

- å®šä¹‰`Object.defineProperties()` , `Object.definePropertie()`
- è·å–`Object.getOwnPropertyDescriptor()`, ECMAScript 2017 `Object.getOwnPropertyDescriptors()`

  ### åˆå¹¶å¯¹è±¡

**æ˜¯æŠŠæºå¯¹è±¡æ‰€æœ‰çš„æœ¬åœ°å±æ€§ä¸€èµ·å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸Š**, æœ‰æ—¶å€™è¿™ç§æ“ä½œä¹Ÿè¢«ç§°ä¸º**â€œæ··å…¥â€ï¼ˆmixinï¼‰**ï¼Œå› ä¸ºç›®æ ‡å¯¹è±¡é€šè¿‡æ··å…¥

æºå¯¹è±¡çš„å±æ€§å¾—åˆ°äº†å¢å¼º

- `Object.assign()`

  - è¿™ä¸ªæ–¹æ³•æ¥æ”¶**ä¸€ä¸ªç›®æ ‡å¯¹è±¡å’Œä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡ä½œä¸ºå‚æ•°**ï¼Œç„¶åå°†æ¯ä¸ªæºå¯¹è±¡ä¸­**å¯æšä¸¾**ï¼ˆObject.propertyIsEnumerable()è¿”å› trueï¼‰å’Œ**è‡ªæœ‰å±æ€§**ï¼ˆObject.hasOwnProperty()è¿”å› trueï¼‰å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡; 

  - å¯¹æ¯ä¸ªç¬¦åˆæ¡ä»¶çš„å±æ€§ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä½¿ç”¨**æºå¯¹è±¡ä¸Šçš„`[[Get]]`å–å¾—å±æ€§çš„å€¼**ï¼Œç„¶åä½¿ç”¨**ç›®æ ‡å¯¹è±¡ä¸Šçš„`[[Set]]`è®¾ç½®å±æ€§çš„å€¼**; 

  - æ‰§è¡Œçš„æ˜¯**æµ…å¤åˆ¶**,  ç›¸åŒçš„å€¼ä¼šè¦†ç›–, å‡½æ•°å¼•ç”¨ä¼šå¤åˆ¶; 

   ```js
    dest = {}; 
    src = { a: {} }; 
    Object.assign(dest, src); 
    // æµ…å¤åˆ¶æ„å‘³ç€åªä¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨
    console.log(dest); // { a :{} } 
    console.log(dest.a === src.a); // true
   ```

  - èµ‹å€¼æœŸé—´å‡ºé”™ï¼Œåˆ™æ“ä½œä¼šä¸­æ­¢å¹¶é€€å‡ºï¼ŒåŒæ—¶æŠ›å‡ºé”™è¯¯, ä½†æ˜¯ä¹‹å‰å·²ç»èµ‹å€¼ä¸ä¼šå›æ»š

  

### æ·±æ‹·è´

https://developer.mozilla.org/zh-CN/docs/Glossary/Deep_copy

[å¦‚ä½•å†™å‡ºä¸€ä¸ªæƒŠè‰³é¢è¯•å®˜çš„æ·±æ‹·è´?](https://juejin.cn/post/6844903929705136141)

```js
export class cloneable {
  public static deepCopy<T>(source: T): T {
    return Array.isArray(source)
    ? source.map(item => this.deepCopy(item))
    : source instanceof Date
    ? new Date(source.getTime())
    : source && typeof source === 'object'
          ? Object.getOwnPropertyNames(source).reduce((o, prop) => {
             Object.defineProperty(o, prop, Object.getOwnPropertyDescriptor(source, prop)!);
             o[prop] = this.deepCopy((source as { [key: string]: any })[prop]);
             return o;
          }, Object.create(Object.getPrototypeOf(source)))
    : source as T;
  }
}
```



### ç†è§£åŸå‹

åŸå‹å¯¹è±¡ `prototype` å’ŒåŸå‹`__proto__`ä¸ä¸€æ ·



æ— è®ºä½•æ—¶ï¼Œåªè¦åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå°±ä¼šæŒ‰ç…§ç‰¹å®šçš„è§„åˆ™ä¸ºè¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ª `prototype` å±æ€§ï¼ˆæŒ‡å‘**åŸå‹å¯¹è±¡**ï¼‰

![image-20230528121335129](/images/image-20230528121335129.png)

`Name.prototype.constructor` æŒ‡å‘ `Name`ã€‚ç„¶åï¼Œå› æ„é€ å‡½æ•°è€Œå¼‚ï¼Œå¯èƒ½ä¼šç»™åŸå‹å¯¹è±¡æ·»åŠ å…¶ä»–å±æ€§å’Œæ–¹æ³•ã€‚

![image-20230528121523878](/images/image-20230528121523878.png)

ä¹Ÿå¯ä»¥é€šè¿‡`Name.__proto__`ï¼Œé€šè¿‡è¿™ä¸ªå±æ€§å¯ä»¥è®¿é—®å¯¹è±¡çš„**åŸå‹**

**å®ä¾‹**ä¸**æ„é€ å‡½æ•°åŸå‹**ä¹‹é—´æœ‰ç›´æ¥çš„è”ç³»ï¼Œä½†**å®ä¾‹ä¸æ„é€ å‡½æ•°ä¹‹é—´æ²¡æœ‰**, ä»¥ä¸‹ä¸ºä¾‹å­

```js
/** 
 * æ„é€ å‡½æ•°å¯ä»¥æ˜¯å‡½æ•°è¡¨è¾¾å¼
 * ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°å£°æ˜ï¼Œå› æ­¤ä»¥ä¸‹ä¸¤ç§å½¢å¼éƒ½å¯ä»¥ï¼š
 * function Person() {} 
 * let Person = function() {} 
 */ 
function Person() {} 
/** 
 * å£°æ˜ä¹‹åï¼Œæ„é€ å‡½æ•°å°±æœ‰äº†ä¸€ä¸ª
 * ä¸ä¹‹å…³è”çš„åŸå‹å¯¹è±¡ï¼š
 */ 
console.log(typeof Person.prototype);// object 
// { 
// constructor: f Person(), 
// __proto__: Object
// }
console.log(Person.prototype); 

/** 
 * å¦‚å‰æ‰€è¿°ï¼Œæ„é€ å‡½æ•°æœ‰ä¸€ä¸ª prototype å±æ€§
 * å¼•ç”¨å…¶åŸå‹å¯¹è±¡ï¼Œè€Œè¿™ä¸ªåŸå‹å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ª
 * constructor å±æ€§ï¼Œå¼•ç”¨è¿™ä¸ªæ„é€ å‡½æ•°
 * æ¢å¥è¯è¯´ï¼Œä¸¤è€…å¾ªç¯å¼•ç”¨ï¼š
 */ 
console.log(Person.prototype.constructor === Person); // true åŸå‹å¯¹è±¡çš„constructoræŒ‡å‘æœ¬ä½“
/*
 * æ­£å¸¸çš„åŸå‹é“¾éƒ½ä¼šç»ˆæ­¢äº Object çš„åŸå‹å¯¹è±¡
 * Object åŸå‹çš„åŸå‹æ˜¯ null 
 */ 
console.log(Person.prototype.__proto__ === Object.prototype); // true 
console.log(Person.prototype.__proto__.constructor === Object); // true 
console.log(Person.prototype.__proto__.__proto__ === null); // true Objectçš„åŸå‹æ˜¯null

let person1 = new Person(), 
    person2 = new Person(); 
/** 
 * æ„é€ å‡½æ•°ã€åŸå‹å¯¹è±¡å’Œå®ä¾‹
 * æ˜¯ 3 ä¸ªå®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼š
 */ 
console.log(person1 !== Person); // true  
console.log(person1 !== Person.prototype); // true 
console.log(Person.prototype !== Person); // true

/** 
 * å®ä¾‹é€šè¿‡__proto__é“¾æ¥åˆ°åŸå‹å¯¹è±¡ï¼Œ
 * å®ƒå®é™…ä¸ŠæŒ‡å‘éšè—ç‰¹æ€§[[Prototype]] 
 * 
 * æ„é€ å‡½æ•°é€šè¿‡ prototype å±æ€§é“¾æ¥åˆ°åŸå‹å¯¹è±¡
 * 
 * å®ä¾‹ä¸æ„é€ å‡½æ•°æ²¡æœ‰ç›´æ¥è”ç³»ï¼Œä¸åŸå‹å¯¹è±¡æœ‰ç›´æ¥è”ç³»
 */ 
console.log(person1.__proto__ === Person.prototype); // true 
conosle.log(person1.__proto__.constructor === Person); // true
/** 
 * åŒä¸€ä¸ªæ„é€ å‡½æ•°åˆ›å»ºçš„ä¸¤ä¸ªå®ä¾‹
 * å…±äº«åŒä¸€ä¸ªåŸå‹å¯¹è±¡ï¼š
 */ 
console.log(person1.__proto__ === person2.__proto__); // true
```

![image-20230528144315910](/images/image-20230528144315910.png)	

é€çº§æŸ¥æ‰¾æœºåˆ¶

> åœ¨é€šè¿‡å¯¹è±¡è®¿é—®å±æ€§æ—¶ï¼Œä¼šæŒ‰ç…§è¿™ä¸ªå±æ€§çš„åç§°å¼€å§‹æœç´¢ã€‚æœç´¢å¼€å§‹äºå¯¹è±¡å®ä¾‹æœ¬èº«ã€‚å¦‚æœåœ¨è¿™ä¸ªå®ä¾‹ä¸Šå‘ç°äº†ç»™å®šçš„åç§°ï¼Œåˆ™è¿”å›è¯¥åç§°å¯¹åº”çš„å€¼ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå±æ€§ï¼Œåˆ™æœç´¢ä¼šæ²¿ç€æŒ‡é’ˆè¿›å…¥åŸå‹å¯¹è±¡ï¼Œç„¶ååœ¨åŸå‹å¯¹è±¡ä¸Šæ‰¾åˆ°å±æ€§åï¼Œå†è¿”å›å¯¹åº”çš„å€¼

**åŸå‹çš„é—®é¢˜**

1. å®ƒ**å¼±åŒ–äº†å‘æ„é€ å‡½æ•°ä¼ é€’åˆå§‹åŒ–å‚æ•°çš„èƒ½åŠ›**ï¼Œ**ä¼šå¯¼è‡´æ‰€æœ‰å®ä¾‹é»˜éƒ½å–å¾—ç›¸åŒçš„å±æ€§å€¼**ã€‚
2. åŸå‹çš„æœ€ä¸»è¦é—®é¢˜æºè‡ªå®ƒçš„å…±äº«ç‰¹æ€§, åŸå§‹å€¼çš„å¼•ç”¨è¿˜å¥½, ä½†æ˜¯å¼•ç”¨å€¼çš„å±æ€§å°±ä¼šå‡ºé—®é¢˜

```js
function Person() {} 
Person.prototype = { 
 constructor: Person, 
 name: "Nicholas", 
 age: 29, 
 job: "Software Engineer", 
 friends: ["Shelby", "Court"],
 sayName() { 
	 console.log(this.name); 
 } 
}; 
let person1 = new Person(); 
let person2 = new Person(); 
person1.friends.push("Van"); // pushäº†ä¸€ä¸ª, æ‰€æœ‰å®ä¾‹çš„å¼•ç”¨å€¼éƒ½å˜äº†
console.log(person1.friends); // "Shelby,Court,Van" 
console.log(person2.friends); // "Shelby,Court,Van" 
console.log(person1.friends === person2.friends); // true
```

### ç»§æ‰¿

**å®ç°ç»§æ‰¿**æ˜¯ ECMAScript å”¯ä¸€æ”¯æŒçš„ç»§æ‰¿æ–¹å¼ï¼Œè€Œè¿™ä¸»è¦æ˜¯é€šè¿‡**åŸå‹é“¾**å®ç°çš„

é‡æ¸©ä¸€ä¸‹æ„é€ å‡½æ•°ã€åŸå‹å’Œå®ä¾‹çš„å…³ç³»ï¼š

æ¯ä¸ª**æ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡**ï¼Œ**åŸå‹æœ‰ä¸€ä¸ªå±æ€§æŒ‡å›æ„é€ å‡½æ•°**ï¼Œè€Œ**å®ä¾‹æœ‰ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆæŒ‡å‘åŸå‹**ã€‚

å¦‚æœåŸå‹æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹å‘¢ï¼Ÿé‚£å°±æ„å‘³ç€è¿™ä¸ªåŸå‹æœ¬èº«æœ‰ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªåŸå‹ï¼Œç›¸åº”åœ°å¦ä¸€ä¸ªåŸå‹ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚è¿™æ ·å°±åœ¨å®ä¾‹å’ŒåŸå‹ä¹‹é—´æ„é€ äº†ä¸€æ¡åŸå‹é“¾

```js
function SuperType() {
   this.property = true; 
} 
SuperType.prototype.getSuperValue = function() { 
 return this.property; 
}; 
function SubType() { 
 this.subproperty = false; 
} 
// ç»§æ‰¿ SuperType 
SubType.prototype = new SuperType(); 
SubType.prototype.getSubValue = function () {
     return this.subproperty; 
}; 
let instance = new SubType(); 
console.log(instance.getSuperValue()); // true
```

**åŸå‹é“¾çš„é—®é¢˜**

- ä¸»è¦é—®é¢˜å‡ºç°åœ¨åŸå‹ä¸­åŒ…å«å¼•ç”¨å€¼çš„æ—¶å€™ã€‚å‰é¢åœ¨è°ˆåˆ°åŸå‹çš„é—®é¢˜æ—¶ä¹Ÿæåˆ°è¿‡ï¼Œ**åŸå‹ä¸­åŒ…å«çš„å¼•ç”¨å€¼ä¼šåœ¨æ‰€æœ‰å®ä¾‹é—´å…±äº«**ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå±æ€§é€šå¸¸ä¼šåœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰è€Œä¸ä¼šå®šä¹‰åœ¨åŸå‹ä¸Šçš„åŸå› 
- åŸå‹é“¾çš„ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œ**å­ç±»å‹åœ¨å®ä¾‹åŒ–æ—¶ä¸èƒ½ç»™çˆ¶ç±»å‹çš„æ„é€ å‡½æ•°ä¼ å‚**ã€‚

ä¸ºäº†è§£å†³åŸå‹åŒ…å«å¼•ç”¨å€¼å¯¼è‡´çš„ç»§æ‰¿é—®é¢˜ï¼Œä¸€ç§å«ä½œ**â€œç›—ç”¨æ„é€ å‡½æ•°â€ï¼ˆconstructor stealingï¼‰**. åŸºæœ¬æ€è·¯å¾ˆç®€å•ï¼šåœ¨å­ç±»æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°

```js
 this.colors = ["red", "blue", "green"]; 
} 
function SubType() { 
 // ç»§æ‰¿ SuperType 
 SuperType.call(this); 
} 
let instance1 = new SubType(); 
instance1.colors.push("black"); 
console.log(instance1.colors); // "red,blue,green,black" 
let instance2 = new SubType(); 
console.log(instance2.colors); // "red,blue,green"
```

ç›—ç”¨æ„é€ å‡½æ•°çš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯å¯ä»¥åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚

```js
function SuperType(name){ 
 this.name = name; 
} 
function SubType() { 
 // ç»§æ‰¿ SuperType å¹¶ä¼ å‚
 SuperType.call(this, "Nicholas"); 
 // å®ä¾‹å±æ€§
 this.age = 29; 
} 
let instance = new SubType(); 
console.log(instance.name); // "Nicholas"; 
console.log(instance.age); // 29
```

é—®é¢˜æ˜¯å‡½æ•°ä¸èƒ½é‡ç”¨, å­ç±»ä¹Ÿä¸èƒ½è®¿é—®çˆ¶ç±»åŸå‹ä¸Šå®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤æ‰€æœ‰ç±»å‹åªèƒ½ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼

### ç»„åˆç»§æ‰¿

**ç»„åˆç»§æ‰¿ï¼ˆæœ‰æ—¶å€™ä¹Ÿå«ä¼ªç»å…¸ç»§æ‰¿ï¼‰**ç»¼åˆäº†åŸå‹é“¾å’Œç›—ç”¨æ„é€ å‡½æ•°ï¼Œå°†ä¸¤è€…çš„ä¼˜ç‚¹é›†ä¸­äº†èµ·æ¥

```js
function SuperType(name){ 
 this.name = name; 
 this.colors = ["red", "blue", "green"]; 
} 
SuperType.prototype.sayName = function() { 
 console.log(this.name); 
}; 
function SubType(name, age){ 
 // ç»§æ‰¿å±æ€§
 SuperType.call(this, name); 
 this.age = age; 
} 
// ç»§æ‰¿æ–¹æ³•
SubType.prototype = new SuperType(); 
SubType.prototype.sayAge = function() { 
 console.log(this.age); 
}; 
let instance1 = new SubType("Nicholas", 29); 
instance1.colors.push("black"); 
console.log(instance1.colors); // "red,blue,green,black" 
instance1.sayName(); // "Nicholas"; 
instance1.sayAge(); // 29 
let instance2 = new SubType("Greg", 27); 
console.log(instance2.colors); // "red,blue,green" 
instance2.sayName(); // "Greg"; 
instance2.sayAge(); // 27
```

### åŸå‹å¼ç»§æ‰¿

å‡ºå‘ç‚¹æ˜¯å³ä½¿**ä¸è‡ªå®šä¹‰ç±»å‹ä¹Ÿå¯ä»¥é€šè¿‡åŸå‹å®ç°å¯¹è±¡ä¹‹é—´çš„ä¿¡æ¯å…±äº«**

```js
// å’ŒObject.create()æ•ˆæœä¸€è‡´
function object(o) { 
 function Father() {} 
 Father.prototype = o; 
 return new Father(); 
}
let person = { 
 name: "Nicholas", 
 friends: ["Shelby", "Court", "Van"] 
}; 
let anotherPerson = object(person); 
anotherPerson.name = "Greg"; 
anotherPerson.friends.push("Rob"); 
let yetAnotherPerson = object(person); 
yetAnotherPerson.name = "Linda"; 
yetAnotherPerson.friends.push("Barbie"); 
console.log(person.friends); // "Shelby,Court,Van,Rob,Barbie"
```

### å¯„ç”Ÿå¼ç»§æ‰¿

ä¸åŸå‹å¼ç»§æ‰¿æ¯”è¾ƒæ¥è¿‘çš„ä¸€ç§ç»§æ‰¿æ–¹å¼æ˜¯**å¯„ç”Ÿå¼ç»§æ‰¿ï¼ˆparasitic inheritanceï¼‰**ï¼Œä¹Ÿæ˜¯ Crockford é¦–å€¡çš„ä¸€ç§æ¨¡å¼ã€‚

å¯„ç”Ÿå¼ç»§æ‰¿èƒŒåçš„æ€è·¯ç±»ä¼¼äº**å¯„ç”Ÿæ„é€ å‡½æ•°å’Œå·¥å‚æ¨¡å¼**ï¼šåˆ›å»ºä¸€ä¸ªå®ç°ç»§æ‰¿çš„å‡½æ•°ï¼Œä»¥æŸç§æ–¹å¼å¢å¼ºå¯¹è±¡ï¼Œç„¶åè¿”å›è¿™ä¸ªå¯¹è±¡

```js
function createAnother(original){ 
 let clone = Object.create(original); // é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡
 clone.sayHi = function() { // ä»¥æŸç§æ–¹å¼å¢å¼ºè¿™ä¸ªå¯¹è±¡
 console.log("hi"); 
 }; 
 return clone; // è¿”å›è¿™ä¸ªå¯¹è±¡
}

let person = { 
 name: "Nicholas", 
 friends: ["Shelby", "Court", "Van"] 
}; 
let anotherPerson = createAnother(person); 
anotherPerson.sayHi(); // "hi"
```

### å¯„ç”Ÿå¼ç»„åˆç»§æ‰¿

**ç»„åˆç»§æ‰¿å…¶å®ä¹Ÿå­˜åœ¨æ•ˆç‡é—®é¢˜**ã€‚æœ€ä¸»è¦çš„æ•ˆç‡é—®é¢˜å°±**æ˜¯çˆ¶ç±»æ„é€ å‡½æ•°å§‹ç»ˆä¼šè¢«è°ƒç”¨ä¸¤æ¬¡**ï¼šä¸€æ¬¡åœ¨æ˜¯åˆ›å»ºå­ç±»åŸå‹æ—¶è°ƒç”¨ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­è°ƒç”¨

```js
function SuperType(name) { 
 this.name = name; 
 this.colors = ["red", "blue", "green"]; 
} 
SuperType.prototype.sayName = function() { 
 console.log(this.name); 
}; 
function SubType(name, age){ 
 SuperType.call(this, name); // ç¬¬äºŒæ¬¡è°ƒç”¨ SuperType() 
 this.age = age; 
} 
SubType.prototype = new SuperType(); // ç¬¬ä¸€æ¬¡è°ƒç”¨ SuperType() 
SubType.prototype.constructor = SubType; 
SubType.prototype.sayAge = function() { 
 console.log(this.age); 
};
```

è€Œå¯„ç”Ÿç»„åˆç»§æ‰¿é€»è¾‘

```js
function inheritPrototype(subType, superType) { 
 let prototype = Object.create(superType.prototype); // åˆ›å»ºå¯¹è±¡
 prototype.constructor = subType; // å¢å¼ºå¯¹è±¡ (è§£å†³ç”±äºé‡å†™åŸå‹å¯¼è‡´é»˜è®¤ constructor ä¸¢å¤±çš„é—®é¢˜)
 subType.prototype = prototype; // èµ‹å€¼å¯¹è±¡
}

function SuperType(name) { 
 this.name = name; 
 this.colors = ["red", "blue", "green"]; 
} 
SuperType.prototype.sayName = function() { 
 console.log(this.name); 
}; 
function SubType(name, age) { 
 SuperType.call(this, name);
     this.age = age; 
} 
inheritPrototype(SubType, SuperType); 
SubType.prototype.sayAge = function() { 
 console.log(this.age); 
};
```




## å‡½æ•°

### å±æ€§å’Œæ–¹æ³•

ECMAScript ä¸­çš„å‡½æ•°æ˜¯å¯¹è±¡ï¼Œå› æ­¤æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸¤ä¸ªå±æ€§ï¼š`length `å’Œ `prototype`ã€‚å…¶ä¸­ï¼Œ`length` å±æ€§ä¿å­˜å‡½æ•°å®šä¹‰çš„å‘½åå‚æ•°çš„ä¸ªæ•°

```js
function sayName(name) { 
 console.log(name); 
} 
function sum(num1, num2) { 
 return num1 + num2; 
} 
function sayHi() { 
 console.log("hi"); 
} 
console.log(sayName.length); // 1 
console.log(sum.length); // 2 
console.log(sayHi.length); // 0
```

`prototype` æ˜¯ä¿å­˜å¼•ç”¨ç±»å‹æ‰€æœ‰**å®ä¾‹æ–¹æ³•**çš„åœ°æ–¹ï¼Œè¿™æ„å‘³ç€ `toString()`ã€`valueOf()`ç­‰æ–¹æ³•å®é™…ä¸Šéƒ½ä¿å­˜åœ¨ `prototype` ä¸Šï¼Œè¿›è€Œç”±æ‰€æœ‰å®ä¾‹å…±äº«

### é—­åŒ…

é—­åŒ…æŒ‡çš„æ˜¯é‚£äº›å¼•ç”¨äº†**å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å‡½æ•°**ï¼Œé€šå¸¸æ˜¯**åœ¨åµŒå¥—å‡½æ•°ä¸­å®ç°**çš„



#### æ‰§è¡Œä¸Šä¸‹æ–‡

**æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆä»¥ä¸‹ç®€ç§°â€œä¸Šä¸‹æ–‡â€ï¼‰**çš„æ¦‚å¿µåœ¨ JavaScript ä¸­æ˜¯é¢‡ä¸ºé‡è¦çš„ã€‚å˜é‡æˆ–å‡½æ•°çš„ä¸Šä¸‹æ–‡**å†³å®šäº†å®ƒä»¬å¯ä»¥è®¿é—®å“ªäº›æ•°æ®**ï¼Œä»¥åŠå®ƒä»¬çš„è¡Œä¸ºã€‚**æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„å˜é‡å¯¹è±¡**ï¼ˆvariable objectï¼‰ï¼Œè€Œè¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½å­˜åœ¨äºè¿™ä¸ªå¯¹è±¡ä¸Š

å…¨å±€ä¸Šä¸‹æ–‡æ˜¯æœ€å¤–å±‚(window)çš„ä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰**varå®šä¹‰çš„å…¨å±€å˜é‡å’Œå‡½æ•°**ï¼Œéƒ½ä¼šæŒ‚è½½åˆ°windowä¸Šï¼Œæˆä¸ºå®ƒçš„å±æ€§å’Œæ–¹æ³•ã€‚

ä½¿ç”¨ let å’Œ const çš„é¡¶çº§å£°æ˜èƒ½å¼•ç”¨ï¼Œä½†ä¸ä¼šæŒ‚è½½windowä¸Šï¼Œå…¶åœ¨**ä½œç”¨åŸŸé“¾è§£æ**çš„æ•ˆæœæ˜¯ä¸€æ ·çš„

ä¸Šä¸‹æ–‡åœ¨**å…¶æ‰€æœ‰ä»£ç éƒ½æ‰§è¡Œå®Œæ¯•åä¼šè¢«é”€æ¯**ï¼ŒåŒ…æ‹¬å®šä¹‰åœ¨å®ƒä¸Šé¢çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°ï¼ˆ**å…¨å±€ä¸Šä¸‹æ–‡åœ¨åº”ç”¨ç¨‹åºé€€å‡ºå‰æ‰ä¼šè¢«é”€æ¯**ï¼Œæ¯”å¦‚å…³é—­ç½‘é¡µæˆ–é€€å‡ºæµè§ˆå™¨ï¼‰ã€‚

**æ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡**ã€‚å½“**ä»£ç æ‰§è¡Œæµè¿›å…¥å‡½æ•°æ—¶ï¼Œå‡½æ•°çš„ä¸Šä¸‹æ–‡è¢«æ¨åˆ°ä¸€ä¸ªä¸Šä¸‹æ–‡æ ˆä¸Š**ã€‚åœ¨**å‡½æ•°æ‰§è¡Œå®Œä¹‹åï¼Œä¸Šä¸‹æ–‡æ ˆä¼šå¼¹å‡ºè¯¥å‡½æ•°ä¸Šä¸‹æ–‡ï¼Œå°†æ§åˆ¶æƒè¿”è¿˜ç»™ä¹‹å‰çš„æ‰§è¡Œä¸Šä¸‹æ–‡**

ä¸Šä¸‹æ–‡ä¸­çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå˜é‡å¯¹è±¡çš„ä¸€ä¸ª**ä½œç”¨åŸŸé“¾ï¼ˆscope chainï¼‰**ã€‚è¿™ä¸ªä½œç”¨åŸŸé“¾å†³å®šäº†å„çº§ä¸Šä¸‹æ–‡ä¸­çš„ä»£ç åœ¨è®¿é—®å˜é‡å’Œå‡½æ•°æ—¶çš„é¡ºåºã€‚**ä»£ç æ­£åœ¨æ‰§è¡Œçš„ä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡å§‹ç»ˆä½äºä½œç”¨åŸŸé“¾çš„æœ€å‰ç«¯**ã€‚è‹¥ä¸Šä¸‹æ–‡æ˜¯å‡½æ•°ï¼Œåˆ™å…¶æ´»åŠ¨å¯¹è±¡ï¼ˆactivation objectï¼‰(arguments)ç”¨ä½œå˜é‡å¯¹è±¡

ä»£ç æ‰§è¡Œæ—¶çš„**æ ‡è¯†ç¬¦è§£ææ˜¯é€šè¿‡æ²¿ä½œç”¨åŸŸé“¾é€çº§æœç´¢æ ‡è¯†ç¬¦åç§°**å®Œæˆçš„ã€‚æœç´¢è¿‡ç¨‹å§‹ç»ˆ**ä»ä½œç”¨åŸŸé“¾çš„æœ€å‰ç«¯å¼€å§‹**ï¼Œç„¶åé€çº§å¾€åï¼Œç›´åˆ°æ‰¾åˆ°æ ‡è¯†ç¬¦ã€‚ï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°æ ‡è¯†ç¬¦ï¼Œé‚£ä¹ˆé€šå¸¸ä¼šæŠ¥é”™ã€‚ï¼‰

**å±€éƒ¨ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡å¯ç”¨äºåœ¨å±€éƒ¨ä¸Šä¸‹æ–‡ä¸­æ›¿æ¢å…¨å±€å˜é‡**ï¼ˆå› ä¸ºæ˜¯ä»ä½œç”¨åŸŸé“¾ä»å‰å¾€åæ‰¾ï¼Œæ‰€ä»¥ï¼Œå±€éƒ¨è‚¯å®šæ¯”å…¨å±€å…ˆè¢«æ‰¾åˆ°ï¼‰



###### ä½œç”¨åŸŸé“¾å¢å¼º

è™½ç„¶æ‰§è¡Œä¸Šä¸‹æ–‡ä¸»è¦æœ‰å…¨å±€ä¸Šä¸‹æ–‡å’Œå‡½æ•°ä¸Šä¸‹æ–‡ä¸¤ç§ï¼ˆ**eval()è°ƒç”¨å†…éƒ¨å­˜åœ¨ç¬¬ä¸‰ç§ä¸Šä¸‹æ–‡**ï¼‰ï¼Œä½†æœ‰å…¶ä»–æ–¹å¼æ¥å¢å¼ºä½œç”¨åŸŸé“¾

æŸäº›è¯­å¥ä¼šå¯¼è‡´åœ¨ä½œç”¨åŸŸé“¾å‰ç«¯ä¸´æ—¶æ·»åŠ ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡åœ¨ä»£ç æ‰§è¡Œåä¼šè¢«åˆ é™¤

- try/catch è¯­å¥çš„ catch å—

- with è¯­å¥

```js
function buildUrl() { 
 let qs = "?debug=true"; 
 with(location){ 
 let url = href + qs; 
 } 
 return url; 
}
```

è¿™é‡Œï¼Œwith è¯­å¥å°† location å¯¹è±¡ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œå› æ­¤ location ä¼šè¢«æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾å‰ç«¯ã€‚ with è¯­å¥ä¸­çš„ä»£ç å¼•ç”¨å˜é‡ href æ—¶ï¼Œå®é™…ä¸Šå¼•ç”¨çš„æ˜¯location.hrefã€‚æ‰¾qsæ—¶ï¼Œlocationå†…æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œæ‰ä¼šå»æ‰¾å‡½æ•°çš„qs



###### ä¾‹å­

å‡è®¾æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªäºŒå±‚é—­åŒ…

```js
let a = 33
var b = 222
var fuc = function three() {
    let gg = 23;
    try {
        console.log(a)
        return function two() {
            var tow_gg = 999
            console.log('two', )
            eval(`console.log('two', tow_gg)`)
            return function one() {
                console.log('one', this)// æŒ‡å‘window
                 return {tow_gg, gg}
            }
        }
    } catch(e) {}
}
console.dir(fuc()())
```

![image-20230527120111449](/images/image-20230527120111449.png)

> Aï¼šä½ å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥å¸®ä½ å›ç­”è¿™ä¸ªé—®é¢˜ã€‚ğŸ˜Š
>
> jsæ€ä¹ˆæŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªé—®é¢˜æœ‰å¤šç§ç­”æ¡ˆï¼Œå–å†³äºä½ æƒ³è¦æŸ¥çœ‹çš„æ˜¯ä»€ä¹ˆç±»å‹çš„ä¸Šä¸‹æ–‡ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šä¸‹æ–‡ï¼ˆContextï¼‰æ˜¯ç¨‹åºè¿è¡Œçš„ç¯å¢ƒï¼Œåœ¨ä¸Šä¸‹æ–‡ä¸­å­˜å‚¨äº†ä¸€æ®µç¨‹åºè¿è¡Œæ—¶æ‰€éœ€è¦çš„å…¨éƒ¨æ•°æ®Â¹ã€‚
>
> å¦‚æœä½ æƒ³è¦æŸ¥çœ‹çš„æ˜¯**æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œä¸€æ®µä»£ç æ—¶åˆ›å»ºçš„å¯¹è±¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨**è°ƒè¯•å·¥å…·**æ¥æŸ¥çœ‹å½“å‰æ‰§è¡Œçš„jsä»£ç çš„ä½ç½®å’Œå˜é‡çš„å€¼â´ã€‚ä¾‹å¦‚ï¼Œåœ¨Chromeæµè§ˆå™¨ä¸­ï¼Œä½ å¯ä»¥æŒ‰F12é”®æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œç„¶ååœ¨Sourcesé¢æ¿ä¸­æ‰¾åˆ°ä½ æƒ³è¦è°ƒè¯•çš„jsæ–‡ä»¶ï¼Œç„¶ååœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ï¼Œç„¶åè¿è¡Œä»£ç ï¼Œå½“ä»£ç æ‰§è¡Œåˆ°æ–­ç‚¹å¤„æ—¶ï¼Œä½ å°±å¯ä»¥åœ¨å³ä¾§çš„Scopeé¢æ¿ä¸­æŸ¥çœ‹å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„è¯æ³•ç¯å¢ƒå¯¹è±¡å’Œå˜é‡ç¯å¢ƒå¯¹è±¡Â¹ã€‚
>
> å¦‚æœä½ æƒ³è¦æŸ¥çœ‹çš„æ˜¯**å…¨å±€ä¸Šä¸‹æ–‡**ï¼Œä¹Ÿå°±æ˜¯åœ¨å¼€å§‹æ‰§è¡Œä¸€æ®µjavascriptä»£ç æ—¶æ‰€åˆ›å»ºçš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œåœ¨htmlç¯å¢ƒä¸­ï¼Œè¯¥ä¸Šä¸‹æ–‡å¯¹è±¡å°±æ˜¯windowå¯¹è±¡Â¹ã€‚åœ¨nodeç¯å¢ƒä¸­ä¸ºglobalå¯¹è±¡Â¹ã€‚é‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨windowæˆ–globalæ¥è®¿é—®å…¨å±€ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚
>
> å¦‚æœä½ æƒ³è¦æŸ¥çœ‹çš„æ˜¯**å‡½æ•°ä¸Šä¸‹æ–‡**ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸€ä¸ªå‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶æ‰€åˆ›å»ºçš„ä¸Šä¸‹æ–‡å¯¹è±¡Â¹ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨**arguments.callee**æ¥è·å–å½“å‰å‡½æ•°å¯¹è±¡Â²ï¼Œç„¶åä½¿ç”¨**arguments.callee.caller**æ¥è·å–è°ƒç”¨å½“å‰å‡½æ•°çš„å‡½æ•°å¯¹è±¡Â²ã€‚ä¾‹å¦‚ï¼š
>
> ```javascript
> function f1() {
> console.log(arguments.callee); //æ‰“å°f1å‡½æ•°å¯¹è±¡
> console.log(arguments.callee.caller); //æ‰“å°f2å‡½æ•°å¯¹è±¡
> }
> 
> function f2() {
> f1();
> }
> 
> f2();
> ```
>
> å¦‚æœä½ æƒ³è¦æŸ¥çœ‹çš„æ˜¯**thisæŒ‡å‘**ï¼Œä¹Ÿå°±æ˜¯åœ¨æ‰§è¡Œä¸€æ®µä»£ç æ—¶thiså…³é”®å­—æ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œé‚£ä¹ˆä½ å¯ä»¥ç›´æ¥ä½¿ç”¨thisæ¥è·å–å½“å‰thisæŒ‡å‘Â³ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒthisæŒ‡å‘å¹¶ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå®ƒä¼šæ ¹æ®å‡½æ•°è°ƒç”¨æ–¹å¼çš„ä¸åŒè€Œæœ‰æ‰€å˜åŒ–Â³ã€‚ä¾‹å¦‚ï¼š
>
> ```javascript
> var name = "global";
> 
> function f1() {
> console.log(this.name); //æ‰“å°global
> }
> 
> var obj = {
> name: "obj",
> f2: function() {
> console.log(this.name); //æ‰“å°obj
> f1(); //æ‰“å°global
> f1.call(this); //æ‰“å°obj
> }
> };
> 
> f1(); //æ‰“å°global
> obj.f2(); //æ‰“å°obj global obj
> ```
>
> ä»¥ä¸Šå°±æ˜¯æˆ‘èƒ½æ‰¾åˆ°çš„å…³äºjsæ€ä¹ˆæŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡çš„ä¸€äº›ç­”æ¡ˆï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚
>
> æº: ä¸å¿…åº”çš„å¯¹è¯ï¼Œ 2023/5/27
> (1) ç†è§£ JavaScript çš„æ‰§è¡Œä¸Šä¸‹æ–‡è¿™ç¯‡å°±å¤Ÿäº†ï¼ - æ˜é‡‘. https://juejin.cn/post/6954966248233009182.
> (2) å¦‚ä½•çŸ¥é“æµè§ˆå™¨å½“å‰æ‰§è¡Œçš„JSä»£ç çš„ä½ç½®ï¼Ÿ - çŸ¥ä¹. https://www.zhihu.com/question/21073282.
> (3) JavaScriptä¸­çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ - æ˜é‡‘. https://juejin.cn/post/7008866769301405726.
> (4) jsä¸­è·å–ä¸Šä¸‹æ–‡è·¯å¾„_xb12369çš„åšå®¢-CSDNåšå®¢. https://blog.csdn.net/xb12369/article/details/46416845.



> [javascriptâ€”â€”æ‰§è¡Œç¯å¢ƒå’Œä½œç”¨åŸŸ](https://blog.csdn.net/viewyu12345/article/details/79653587)
>
> [ scopesç»“åˆå®é™…åˆ†æ ](


### es6

#### WeakMapçš„ä½¿ç”¨æ–¹å¼

WeakMapä¸­ï¼Œåªè¦å€¼çš„å¼•ç”¨ä¸å­˜åœ¨ï¼Œå°±ä¼šè‡ªåŠ¨é”€æ¯ï¼›å¹¶ä¸”å› ä¸ºå…¶è¿™ä¸ªç‰¹æ€§ï¼Œå®ƒæ˜¯ä¸å¯è¿­ä»£çš„ï¼Œåªèƒ½é€šè¿‡åŸå§‹å¼•ç”¨å–å¾—é”®å€¼

```js
const wm = new WeakMap(); 
wm.set({}, "val");
```

set()æ–¹æ³•åˆå§‹åŒ–äº†ä¸€ä¸ªæ–°å¯¹è±¡å¹¶å°†å®ƒç”¨ä½œä¸€ä¸ªå­—ç¬¦ä¸²çš„é”®ã€‚å› ä¸º**æ²¡æœ‰æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å…¶ä»–å¼•ç”¨**ï¼Œ æ‰€ä»¥å½“è¿™è¡Œä»£ç æ‰§è¡Œå®Œæˆåï¼Œ**è¿™ä¸ªå¯¹è±¡é”®å°±ä¼šè¢«å½“ä½œåƒåœ¾å›æ”¶**ã€‚

##### 1. ç§æœ‰å˜é‡

å¼±æ˜ å°„é€ å°±äº†åœ¨ JavaScript ä¸­å®ç°çœŸæ­£**ç§æœ‰å˜é‡**çš„ä¸€ç§æ–°æ–¹å¼ã€‚å‰ææ˜¯ï¼Œ**ç§æœ‰å˜é‡ä¼šå­˜å‚¨åœ¨å¼±æ˜ å°„ä¸­ï¼Œä»¥å¯¹è±¡å®ä¾‹ä¸ºé”®ï¼Œä»¥ç§æœ‰æˆå‘˜çš„å­—å…¸ä¸ºå€¼**

```js
const wm = new WeakMap(); 
class User { 
 constructor(id) { 
     this.idProperty = Symbol('id'); 
     this.setId(id); 
 } 
 setPrivate(property, value) { 
     const privateMembers = wm.get(this) || {}; 
     privateMembers[property] = value; 
     // å½“å‰å¼•ç”¨ä½œä¸ºé”®ï¼Œæˆå‘˜å¯¹è±¡ä½œä¸ºå€¼
     wm.set(this, privateMembers); 
 } 
 getPrivate(property) { 
	 return wm.get(this)[property]; 
 } 
 setId(id) { 
     // è®¾ç½®ç§æœ‰, propertyå€¼éƒ½æ˜¯å›ºå®šçš„
	 this.setPrivate(this.idProperty, id); 
 } 
 getId() { 
	 return this.getPrivate(this.idProperty); 
 } 
} 
const user = new User(123); 
alert(user.getId()); // 123 
user.setId(456); 
alert(user.getId()); // 456 
// å¹¶ä¸æ˜¯çœŸæ­£ç§æœ‰çš„
alert(wm.get(user)[user.idProperty]); // 456
```

å¯¹äºä¸Šé¢çš„å®ç°ï¼Œå¤–éƒ¨ä»£ç åªéœ€è¦æ‹¿åˆ°**å¯¹è±¡å®ä¾‹çš„å¼•ç”¨å’Œå¼±æ˜ å°„**ï¼Œå°±å¯ä»¥å–å¾—â€œç§æœ‰â€å˜é‡äº†, ä¸ºäº†é¿å…è¿™ç§è®¿é—®ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªé—­åŒ…æŠŠ WeakMap åŒ…è£…èµ·æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå¼±æ˜ å°„ä¸å¤–ç•Œå®Œå…¨éš”ç¦»å¼€äº†

```js
// ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œé—­åŒ…ï¼Œwmä¸€ç›´è¢«è¿”å›çš„Userçš„classæŒæœ‰ï¼Œå°±ä¸ä¼šè§¦å‘åƒåœ¾å›æ”¶
const User = (() => { 
     const wm = new WeakMap(); 
     class User { 
         constructor(id) { 
       	  	this.idProperty = Symbol('id');
        	this.setId(id); 
         } 
     	setPrivate(property, value) { 
             const privateMembers = wm.get(this) || {}; 
             privateMembers[property] = value; 
             wm.set(this, privateMembers); 
     	} 
         getPrivate(property) { 
       	 	 return wm.get(this)[property]; 
         } 
         setId(id) { 
        	 this.setPrivate(this.idProperty, id); 
         } 
         getId(id) { 
        	 return this.getPrivate(this.idProperty); 
         } 
     } 
     return User; 
})();
const user = new User(123); 
alert(user.getId()); // 123 
user.setId(456); 
alert(user.getId()); // 456
```

è¿™æ ·ï¼Œæ‹¿ä¸åˆ°å¼±æ˜ å°„ä¸­çš„å¥ï¼Œä¹Ÿå°±æ— æ³•å–å¾—å¼±æ˜ å°„ä¸­å¯¹åº”çš„å€¼ã€‚è™½ç„¶è¿™é˜²æ­¢äº†å‰é¢æåˆ°çš„è®¿é—®ï¼Œä½†æ•´ä¸ªä»£ç ä¹Ÿå®Œå…¨é™·å…¥äº† ES6 ä¹‹å‰çš„é—­åŒ…ç§æœ‰å˜é‡æ¨¡å¼ã€‚

```js
const User = (function () {
  const wm = new WeakMap()
  function User() {
    const idProperty = Symbol('id')
    return {
      set(id) {
        const privateMember = wm.get(this) || {}
        privateMember[idProperty] = id
        wm.set(this, privateMember)
      },
      get(id) {
        return wm.get(this)[idProperty]
      },
    }
  }
  return User
})()
```



##### 2. DOM èŠ‚ç‚¹å…ƒæ•°æ®

å› ä¸º WeakMap å®ä¾‹ä¸ä¼šå¦¨ç¢åƒåœ¾å›æ”¶ï¼Œæ‰€ä»¥éå¸¸é€‚åˆä¿å­˜å…³è”å…ƒæ•°æ®ã€‚æ¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œå…¶ä¸­ä½¿ç”¨äº†å¸¸è§„çš„ Map

```js
const m = new Map(); 
const loginButton = document.querySelector('#login'); 
// ç»™è¿™ä¸ªèŠ‚ç‚¹å…³è”ä¸€äº›å…ƒæ•°æ®
m.set(loginButton, {disabled: true});
```

å‡è®¾åœ¨ä¸Šé¢çš„ä»£ç æ‰§è¡Œåï¼Œé¡µé¢è¢« JavaScript æ”¹å˜äº†ï¼ŒåŸæ¥çš„ç™»å½•æŒ‰é’®ä» DOM æ ‘ä¸­è¢«åˆ æ‰äº†ã€‚ä½†ç”±äºæ˜ å°„ä¸­è¿˜ä¿å­˜ç€æŒ‰é’®çš„å¼•ç”¨ï¼Œæ‰€ä»¥å¯¹åº”çš„ DOM èŠ‚ç‚¹ä»ç„¶ä¼šé€—ç•™åœ¨å†…å­˜ä¸­ï¼Œé™¤éæ˜ç¡®å°†å…¶ä»æ˜ å°„ä¸­åˆ é™¤æˆ–è€…ç­‰åˆ°æ˜ å°„æœ¬èº«è¢«é”€æ¯

å¦‚æœè¿™é‡Œä½¿ç”¨çš„æ˜¯å¼±æ˜ å°„ï¼Œå¦‚ä»¥ä¸‹ä»£ç æ‰€ç¤ºï¼Œé‚£ä¹ˆå½“èŠ‚ç‚¹ä» DOM æ ‘ä¸­è¢«åˆ é™¤åï¼Œåƒåœ¾å›æ”¶ç¨‹åºå°±å¯ä»¥ç«‹å³é‡Šæ”¾å…¶å†…å­˜ï¼ˆå‡è®¾æ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼‰ï¼š

```js
const wm = new WeakMap(); 
const loginButton = document.querySelector('#login'); 
// ç»™è¿™ä¸ªèŠ‚ç‚¹å…³è”ä¸€äº›å…ƒæ•°æ®
wm.set(loginButton, {disabled: true});
```

## è¿­ä»£å™¨

å¦‚æœè¿­ä»£å™¨æ²¡æœ‰å…³é—­ï¼Œåˆ™è¿˜å¯ä»¥ç»§ç»­ä»ä¸Šæ¬¡ç¦»å¼€çš„åœ°æ–¹ç»§ç»­è¿­ä»£ã€‚æ¯”å¦‚ï¼Œæ•°ç»„çš„è¿­ä»£å™¨å°±æ˜¯ä¸èƒ½å…³é—­çš„

```js
let a = [1, 2, 3, 4, 5];
let iter = a[Symbol.iterator](); 
for (let i of iter) { 
 console.log(i); 
 if (i > 2) { 
 break 
 } 
} 
// 1 
// 2 
// 3 
for (let i of iter) { 
 console.log(i); 
} 
// 4 
// 5
```

å› ä¸º return()æ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥å¹¶éæ‰€æœ‰è¿­ä»£å™¨éƒ½æ˜¯å¯å…³é—­çš„ã€‚è¦çŸ¥é“æŸä¸ªè¿­ä»£å™¨æ˜¯å¦å¯å…³é—­ï¼Œå¯ä»¥æµ‹è¯•è¿™ä¸ªè¿­ä»£å™¨å®ä¾‹çš„ return å±æ€§æ˜¯ä¸æ˜¯å‡½æ•°å¯¹è±¡ã€‚ä¸è¿‡ï¼Œä»…ä»…ç»™ä¸€ä¸ªä¸å¯å…³é—­çš„è¿­ä»£å™¨å¢åŠ è¿™ä¸ªæ–¹æ³•å¹¶ä¸èƒ½è®©å®ƒå˜æˆå¯å…³é—­çš„ã€‚è¿™æ˜¯å› ä¸ºè°ƒç”¨ return()ä¸ä¼šå¼ºåˆ¶è¿­ä»£å™¨è¿›å…¥å…³é—­çŠ¶æ€ã€‚å³ä¾¿å¦‚æ­¤ï¼Œreturn()æ–¹æ³•è¿˜æ˜¯ä¼šè¢«è°ƒç”¨ã€‚

é‚£å¦‚ä½•å…³é—­ï¼Ÿç­”æ¡ˆæ˜¯ä¸å»ç®¡å®ƒï¼Œæˆ–è€…ç”Ÿæˆæ–°çš„è¿­ä»£å¯¹è±¡ï¼Œæˆ–è€…ç›´æ¥è¿­ä»£å®ƒçš„æœ¬ä½“ï¼Œä¸ç”¨è¿­ä»£å™¨

[JavaScriptè¿­ä»£å™¨å¦‚ä½•å…³é—­?](https://www.zhihu.com/question/462012759)

## Event Loop	

[ä¸€æ¬¡å¼„æ‡‚Event Loopï¼ˆå½»åº•è§£å†³æ­¤ç±»é¢è¯•é—®é¢˜ï¼‰](https://juejin.cn/post/6844903764202094606)

`Event Loop`å³äº‹ä»¶å¾ªç¯ï¼Œæ˜¯æŒ‡æµè§ˆå™¨æˆ–`Node`çš„ä¸€ç§è§£å†³`javaScript`å•çº¿ç¨‹è¿è¡Œæ—¶ä¸ä¼šé˜»å¡çš„ä¸€ç§æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸ä½¿ç”¨**å¼‚æ­¥**çš„åŸç†ã€‚

åœ¨`JavaScript`ä¸­ï¼Œä»»åŠ¡è¢«åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§**å®ä»»åŠ¡**ï¼ˆ`MacroTask`ï¼‰ä¹Ÿå«`Task`ï¼Œä¸€ç§å«**å¾®ä»»åŠ¡**ï¼ˆ`MicroTask`ï¼‰ã€‚

### MacroTaskï¼ˆå®ä»»åŠ¡ï¼‰

 `script`å…¨éƒ¨ä»£ç ã€`setTimeout`ã€`setInterval`ã€`setImmediate`ï¼ˆæµè§ˆå™¨æš‚æ—¶ä¸æ”¯æŒï¼Œåªæœ‰IE10æ”¯æŒï¼Œå…·ä½“å¯è§[`MDN`](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FsetImmediate)ï¼‰ã€`I/O`ã€`UI Rendering`ã€‚

### MicroTaskï¼ˆå¾®ä»»åŠ¡ï¼‰

 `Process.nextTickï¼ˆNodeç‹¬æœ‰ï¼‰`ã€`Promise`ã€`Object.observe(åºŸå¼ƒ)`ã€`MutationObserver`ï¼ˆå…·ä½“ä½¿ç”¨æ–¹å¼æŸ¥çœ‹[è¿™é‡Œ](https://link.juejin.cn/?target=http%3A%2F%2Fjavascript.ruanyifeng.com%2Fdom%2Fmutationobserver.html)ï¼‰

[åœ¨ JavaScript ä¸­é€šè¿‡ queueMicrotask() ä½¿ç”¨å¾®ä»»åŠ¡](https://developer.mozilla.org/zh-CN/docs/Web/API/HTML_DOM_API/Microtask_guide)



### æµè§ˆå™¨ä¸­çš„Event Loop

`Javascript` æœ‰ä¸€ä¸ª `main thread` ä¸»çº¿ç¨‹å’Œ `call-stack` è°ƒç”¨æ ˆ(æ‰§è¡Œæ ˆ)ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šè¢«æ”¾åˆ°è°ƒç”¨æ ˆç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚

#### JSè°ƒç”¨æ ˆ

JS**è°ƒç”¨æ ˆ**é‡‡ç”¨çš„æ˜¯**åè¿›å…ˆå‡º**çš„è§„åˆ™ï¼Œå½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¼šè¢«æ·»åŠ åˆ°æ ˆçš„é¡¶éƒ¨ï¼Œå½“æ‰§è¡Œæ ˆæ‰§è¡Œå®Œæˆåï¼Œå°±ä¼šä»æ ˆé¡¶ç§»å‡ºï¼Œç›´åˆ°æ ˆå†…è¢«æ¸…ç©ºã€‚

#### åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡

`Javascript`å•çº¿ç¨‹ä»»åŠ¡è¢«åˆ†ä¸º**åŒæ­¥ä»»åŠ¡**å’Œ**å¼‚æ­¥ä»»åŠ¡**

- åŒæ­¥ä»»åŠ¡ä¼šåœ¨è°ƒç”¨æ ˆä¸­æŒ‰ç…§**é¡ºåºç­‰å¾…**ä¸»çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œ
- å¼‚æ­¥ä»»åŠ¡**ä¼šåœ¨å¼‚æ­¥ä»»åŠ¡æœ‰äº†ç»“æœå**ï¼Œ**å°†æ³¨å†Œçš„å›è°ƒå‡½æ•°æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶å€™**ï¼ˆè°ƒç”¨æ ˆè¢«æ¸…ç©ºï¼‰ï¼Œè¢«è¯»å–åˆ°æ ˆå†…ç­‰å¾…ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚
  - ä»»åŠ¡é˜Ÿåˆ—`Task Queue`ï¼Œå³é˜Ÿåˆ—ï¼Œæ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„ä¸€ç§æ•°æ®ç»“æ„ã€‚
  - <img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/1/18/1685f037d48da0de~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp" alt="img" style="zoom: 80%;" />

#### äº‹ä»¶å¾ªç¯çš„è¿›ç¨‹æ¨¡å‹

- é€‰æ‹©**å½“å‰è¦æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—**ï¼Œé€‰æ‹©ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€å…ˆè¿›å…¥çš„ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºå³`null`ï¼Œåˆ™æ‰§è¡Œè·³è½¬åˆ°å¾®ä»»åŠ¡ï¼ˆ`MicroTask`ï¼‰çš„æ‰§è¡Œæ­¥éª¤ã€‚
- å°†**äº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡è®¾ç½®ä¸ºå·²é€‰æ‹©ä»»åŠ¡**ã€‚
- æ‰§è¡Œä»»åŠ¡ã€‚
- å°†**äº‹ä»¶å¾ªç¯ä¸­å½“å‰è¿è¡Œä»»åŠ¡è®¾ç½®ä¸ºnull**ã€‚
- å°†å·²ç»è¿è¡Œå®Œæˆçš„ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚
- microtasksæ­¥éª¤ï¼šè¿›å…¥microtaskæ£€æŸ¥ç‚¹ã€‚
- æ›´æ–°ç•Œé¢æ¸²æŸ“ã€‚
- è¿”å›ç¬¬ä¸€æ­¥ã€‚

#### æ‰§è¡Œè¿›å…¥microtaskæ£€æŸ¥ç‚¹æ—¶ï¼Œç”¨æˆ·ä»£ç†ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

- è®¾ç½®`microtask`æ£€æŸ¥ç‚¹æ ‡å¿—ä¸ºtrueã€‚
- å½“äº‹ä»¶å¾ªç¯`microtask`æ‰§è¡Œä¸ä¸ºç©ºæ—¶ï¼šé€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥çš„`microtask`é˜Ÿåˆ—çš„`microtask`ï¼Œå°†äº‹ä»¶å¾ªç¯çš„`microtask`è®¾ç½®ä¸ºå·²é€‰æ‹©çš„`microtask`ï¼Œè¿è¡Œ`microtask`ï¼Œå°†å·²ç»æ‰§è¡Œå®Œæˆçš„`microtask`ä¸º`null`ï¼Œç§»å‡º`microtask`ä¸­çš„`microtask`ã€‚
- æ¸…ç†IndexDBäº‹åŠ¡
- è®¾ç½®è¿›å…¥microtaskæ£€æŸ¥ç‚¹çš„æ ‡å¿—ä¸ºfalseã€‚

![img](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/1/18/1686078c7a2f63e5~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

æ‰§è¡Œæ ˆåœ¨æ‰§è¡Œå®Œ**åŒæ­¥ä»»åŠ¡**åï¼ŒæŸ¥çœ‹**æ‰§è¡Œæ ˆ**æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ‰§è¡Œæ ˆä¸ºç©ºï¼Œå°±ä¼šå»æ£€æŸ¥**å¾®ä»»åŠ¡**(`microTask`)é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºçš„è¯ï¼Œå°±æ‰§è¡Œ`Task`ï¼ˆå®ä»»åŠ¡ï¼‰ï¼Œå¦åˆ™å°±ä¸€æ¬¡æ€§æ‰§è¡Œå®Œæ‰€æœ‰å¾®ä»»åŠ¡ã€‚

æ¯æ¬¡å•ä¸ª**å®ä»»åŠ¡**æ‰§è¡Œå®Œæ¯•åï¼Œæ£€æŸ¥**å¾®ä»»åŠ¡**(`microTask`)é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œä¼šæŒ‰ç…§**å…ˆå…¥å…ˆ**å‡ºçš„è§„åˆ™å…¨éƒ¨æ‰§è¡Œå®Œ**å¾®ä»»åŠ¡**(`microTask`)åï¼Œè®¾ç½®**å¾®ä»»åŠ¡**(`microTask`)é˜Ÿåˆ—ä¸º`null`ï¼Œç„¶åå†æ‰§è¡Œ**å®ä»»åŠ¡**ï¼Œå¦‚æ­¤å¾ªç¯ã€‚

> å³æ‰§è¡Œæ ˆä¸­è¿è¡ŒåŒæ­¥ä»»åŠ¡ -> æ£€æŸ¥å¾®ä»»åŠ¡ -> å®ä»»åŠ¡ -> æ£€æŸ¥å¾®ä»»åŠ¡

 #### æµ‹è¯•

```js
(async () => {
  async function a1() {
    console.log('async a1') // 2
    await a2()
  }

  async function a2() {
    console.log('async a2') // 3
  }
  async function a3() {
    console.log('async a3') // 6
  }
  console.log('start') // 1
  a1()
  setTimeout(() => {
    console.log('timeout 1') // 8
  }, 0)
  Promise.resolve().then(async () => {
    console.log('Promise 1') // 5 
    await a3()
  }).then(() => {
    console.log('Promise 2') // 7
  })
  console.log('end') // 4
})()

```

## abort

### 1. cancel promise

```html
<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div id="status">IDLE</div>
  <button type="button" id="abort-btn" onclick="cancelPromise()">Abort</button>
</body>
<script>

  const controller = new window.AbortController()
  const signal = controller.signal
  function cancelPromise() {
    controller.abort()
    console.log('cancelPromise', controller)
  }

  window.onload = () => {
    const elem = document.querySelector('#status')
  
    const example = (s) => {
      return new Promise((resolve, reject) => {
        let timeout = setTimeout(() => {
          elem.textContent = 'Promise resolved'
          resolve('resolved')
        }, 5000)
        s.addEventListener('abort', () => {
          elem.textContent = 'Promise aborted'
          clearTimeout(timeout)
          reject('Promise aborted')
        })
      })
    }

    example(signal)
      .then(data => {
        console.log(data)
      }).catch(err => {
      console.log("Catch: ", err)
    })
    document.getElementById('abort-btn').addEventListener('click', cancelPromise);

  }
</script>
</html>
```

### 2. cancel fetch

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Abort APi example</title>
  <style>
    .wrapper {
      width: 70%;
      max-width: 800px;
      margin: 0 auto;
    }

    video {
      max-width: 100%;
    }

    .wrapper > div {
      margin-bottom: 10px;
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body>
<div class="wrapper">
  <h1>Simple offline video player</h1>
  <div class="controls">
    <button class="download">Download video</button>
    <button class="abort hidden">Cancel download</button>
    <p class="reports"></p>
  </div>
  <div class="videoWrapper hidden">
    <p>Sintel Â© copyright Blender Foundation | <a href="http://www.sintel.org/">www.sintel.org</a>.</p>
  </div>
</div>
</body>
<script>
  const url = 'https://mdn.github.io/dom-examples/abort-api/sintel.mp4';

  const videoWrapper = document.querySelector('.videoWrapper');
  const downloadBtn = document.querySelector('.download');
  const abortBtn = document.querySelector('.abort');
  const reports = document.querySelector('.reports');

  let controller;
  let progressAnim;
  let animCount = 0;

  downloadBtn.addEventListener('click', fetchVideo);

  abortBtn.addEventListener('click', () => {
    controller.abort();
    console.log('Download aborted');
    downloadBtn.classList.remove('hidden');
  });

  function fetchVideo() {
    controller = new AbortController();
    const signal = controller.signal;
    downloadBtn.classList.add('hidden');
    abortBtn.classList.remove('hidden');
    reports.textContent = 'Video awaiting download...';
    fetch(url, { signal }).then((response) => {
      if (response.status === 200) {
        runAnimation();
        setTimeout(() => console.log('Body used: ', response.bodyUsed), 1);
        return response.blob();
      } else {
        throw new Error('Failed to fetch');
      }
    }).then((myBlob) => {
      const video = document.createElement('video');
      video.setAttribute('controls', '');
      video.src = URL.createObjectURL(myBlob);
      videoWrapper.appendChild(video);

      videoWrapper.classList.remove('hidden');
      abortBtn.classList.add('hidden');
      downloadBtn.classList.add('hidden');

      reports.textContent = 'Video ready to play';
    }).catch((e) => {
      abortBtn.classList.add('hidden');
      downloadBtn.classList.remove('hidden');
      reports.textContent = 'Download error: ' + e.message;
    }).finally(() => {
      clearInterval(progressAnim);
      animCount = 0;
    });
  }

  function runAnimation() {
    progressAnim = setInterval(() => {
      switch (animCount++ & 3) {
        case 0: reports.textContent = 'Download occuring; waiting for video player to be constructed'; break;
        case 1: reports.textContent = 'Download occuring; waiting for video player to be constructed.'; break;
        case 2: reports.textContent = 'Download occuring; waiting for video player to be constructed..'; break;
        case 3: reports.textContent = 'Download occuring; waiting for video player to be constructed...'; break;
      }
    }, 300);
  }

</script>

</html>

```

### 3. remove EventListener

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
<table id="outside">
  <tr><td id="t1">one</td></tr>
  <tr><td id="t2">two</td></tr>
</table>
<script>
  // ä¸º table æ·»åŠ å¯è¢«ç§»é™¤çš„äº‹ä»¶ç›‘å¬å™¨
  const controller = new AbortController();
  const el = document.getElementById("outside");
  el.addEventListener("click", modifyText, { signal: controller.signal } );

  // æ”¹å˜ t2 å†…å®¹çš„å‡½æ•°
  function modifyText() {
    const t2 = document.getElementById("t2");
    if (t2.firstChild.nodeValue === "three") {
      t2.firstChild.nodeValue = "two";
    } else {
      t2.firstChild.nodeValue = "three";
      controller.abort(); // å½“å€¼å˜ä¸º "three" åï¼Œç§»é™¤ç›‘å¬å™¨
    }
  }

</script>
</body>
</html>
```





##  API

#### **XMLHttpRequest** 

[ä½ ä¸çŸ¥é“çš„ XMLHttpRequest](https://juejin.cn/post/6844903472714743816#heading-11)

[æµè§ˆå™¨åŸç† 16 # WebAPIï¼šXMLHttpRequestæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ](https://blog.51cto.com/kaimo313/5588730?u_atoken=73adc4e3-38bc-43c4-bd6c-087ce2b8417b&u_asession=01ljSl4y9K2L3WNSrYkz3GvjwyLe2kxONedm92J-v1BYEhnkmYl853nUsBI5ndMdTJX0KNBwm7Lovlpxjd_P_q4JsKWYrT3W_NKPr8w6oU7K8bR9gCR6IBTSe5ADpEBlJPC87erDcbjPeVmmYm9Bwo5GBkFo3NEHBv0PZUm6pbxQU&u_asig=05AKYiLESMHAo-kt1XbMg8Muf06BRiwXJT_aRGEvYd8GDuUgnD1bRVAr--aIepErcpsZnDYY4LarXoiHiwaO5iunJoBAf3qoTPhwiAGzrv5p7SnfOQuyqDTvAcz7VMFSYPypMNaUc3J_d-Hqh4SaxeOIp9fKGlrCFhblb41ywN-5X9JS7q8ZD7Xtz2Ly-b0kmuyAKRFSVJkkdwVUnyHAIJzdvZCy5SVOMnx8xDv66_mjrxW4QleAWzAYI39UmizlcDlSZUIrL_IYSL36TRsulst-3h9VXwMyh6PgyDIVSG1W-7om_KiZSyYHQaLgB0NBigSEcogZ2DgZT5yDQWmrrPR4md-LDKLYHPrf8gI7SD7fgexYQFuqTMqAptfdntnflGmWspDxyAEEo4kbsryBKb9Q&u_aref=DkoPqiX6t7MtkWFB1yzpPia%2FhIw%3D)

`@mswjs/src/interceptors/XMLHttpRequest/XMLHttpRequestOverride.ts`å¯ä»¥å‚è€ƒè¿™ä¸ªäºŒæ¬¡å°è£…

## é—®ç­”

### es6æˆ–æ›´é«˜çš„jsæ•°æ®ç»“æ„ï¼Œå¦‚WeakMapï¼Œæ€ä¹ˆè½¬æ¢æˆæ—§æ—¶ä»£æµè§ˆå™¨å¯ä»¥è¿è¡Œçš„æ–¹å¼ï¼ŒåŸç†æ˜¯ä»€ä¹ˆ

> ä½ å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥å¸®ä½ å›ç­”è¿™ä¸ªé—®é¢˜ã€‚ğŸ˜Š
>
> es6æˆ–æ›´é«˜çš„jsæ•°æ®ç»“æ„ï¼Œå¦‚WeakMapï¼Œæ€ä¹ˆè½¬æ¢æˆæ—§æ—¶ä»£æµè§ˆå™¨å¯ä»¥è¿è¡Œçš„æ–¹å¼ï¼ŒåŸç†æ˜¯ä»€ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ä½¿ç”¨**polyfill**ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§ç”¨æ¥æ¨¡æ‹ŸåŸç”ŸåŠŸèƒ½çš„ä»£ç Â¹ã€‚
>
> polyfillçš„åŸç†æ˜¯æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæŸä¸ªç‰¹æ€§ï¼Œå¦‚æœä¸æ”¯æŒï¼Œå°±ç”¨jsä»£ç æ¥å®ç°è¯¥ç‰¹æ€§çš„åŠŸèƒ½Â¹ã€‚ä¾‹å¦‚ï¼ŒWeakMapæ˜¯ä¸€ç§ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œä¸”ä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶Â²ã€‚å¦‚æœæµè§ˆå™¨ä¸æ”¯æŒWeakMapï¼Œå°±å¯ä»¥ç”¨ä¸€ä¸ªæ•°ç»„æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œç„¶åç”¨ä¸€ä¸ªéšè—å±æ€§æ¥æ ‡è®°é”®å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨åƒåœ¾å›æ”¶æ—¶åˆ é™¤å¯¹åº”çš„é”®å€¼å¯¹Â³ã€‚
>
> æœ‰ä¸€äº›å¼€æºçš„åº“æä¾›äº†es6æˆ–æ›´é«˜çš„jsæ•°æ®ç»“æ„çš„polyfillï¼Œä¾‹å¦‚weakmap-polyfillÂ¹ å’Œes6-structsã€‚ä½ å¯ä»¥ä½¿ç”¨npmå®‰è£…è¿™äº›åº“ï¼Œç„¶ååœ¨ä½ çš„ä»£ç ä¸­å¼•å…¥å®ƒä»¬ï¼Œå°±å¯ä»¥åœ¨æ—§æ—¶ä»£æµè§ˆå™¨ä¸­ä½¿ç”¨WeakMapç­‰æ•°æ®ç»“æ„äº†Â¹ ã€‚
>
> ä»¥ä¸Šå°±æ˜¯æˆ‘èƒ½æ‰¾åˆ°çš„å…³äºes6æˆ–æ›´é«˜çš„jsæ•°æ®ç»“æ„ï¼Œå¦‚WeakMapï¼Œæ€ä¹ˆè½¬æ¢æˆæ—§æ—¶ä»£æµè§ˆå™¨å¯ä»¥è¿è¡Œçš„æ–¹å¼ï¼ŒåŸç†æ˜¯ä»€ä¹ˆçš„ä¸€äº›ç­”æ¡ˆï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚
>
> æº: ä¸å¿…åº”çš„å¯¹è¯ï¼Œ 2023/5/27
> (1) polygonplanet/weakmap-polyfill: ECMAScript6 WeakMap polyfill - GitHub. https://github.com/polygonplanet/weakmap-polyfill.
> (2) weakmap-polyfill - npm. https://www.npmjs.com/package/weakmap-polyfill.
> (3) dregre/es6-structs: Polyfills for WeakMap, Map, WeakSet, and Set. - GitHub. https://github.com/dregre/es6-structs.

### [ä»ä¸¤ä¸ªè§’åº¦ç†è§£ä¸ºä»€ä¹ˆ JS ä¸­æ²¡æœ‰å‡½æ•°é‡è½½ ](https://www.cnblogs.com/zhangguicheng/p/12155512.html)

1. æ–¹æ³•ç­¾å

æ–¹æ³•ç­¾åæŒ‡çš„æ˜¯**å‡½æ•°çš„åç§°åŠ å½¢å‚åˆ—è¡¨**ï¼Œå¹¶ä¸”é€šè¿‡å‡½æ•°çš„åç§°æˆ–è€…å½¢å‚åˆ—è¡¨éƒ½å¯ä»¥åŒºåˆ†å‡ºæ˜¯ä¸åŒçš„å‡½æ•°ã€‚è€Œjsæ˜¯å¼±ç±»å‹è¯­è¨€ï¼Œå‚æ•°ä¸å›ºå®šï¼Œä¹Ÿæ²¡æœ‰ç±»å‹ï¼Œæ‰€ä»¥æ²¡æœ‰é‡è½½

2. å‡½æ•°æŒ‡é’ˆ

å®šä¹‰äº†ä¸¤ä¸ªåŒåå‡½æ•°ï¼Œåˆ™åå®šä¹‰çš„ä¼šè¦†ç›–å…ˆå®šä¹‰çš„

### ä½ çŸ¥é“+0ä¸-0çš„åŒºåˆ«å—ï¼Ÿ

https://blog.csdn.net/qiwoo_weekly/article/details/101442976

https://juejin.cn/post/6844903812931518478